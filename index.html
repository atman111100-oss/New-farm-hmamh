<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯ÙˆØ§Ø¬Ù†</title>
<style>
  :root{
    --green:#2e7d32; --green-2:#388e3c; --bg:#f6f7f9; --card:#fff; --text:#1f2937; --muted:#6b7280;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Tahoma,Arial,sans-serif;background:var(--bg);color:var(--text)}
  header{background:var(--green);color:#fff;padding:14px}
  header .wrap{max-width:1000px;margin:auto;display:flex;justify-content:space-between;align-items:center;gap:8px}
  header h1{font-size:1.15rem;margin:0}
  header small{color:#e5f4e7}
  nav{background:var(--green-2);display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:8px}
  nav a{color:#fff;text-decoration:none;padding:8px 12px;border-radius:10px}
  nav a.active, nav a:hover{background:#1b5e20}
  main{max-width:1000px;margin:18px auto;padding:0 12px}
  .card{background:var(--card);border-radius:14px;box-shadow:0 8px 18px rgba(16,24,40,.04);padding:16px;margin-bottom:16px}
  .card h2{margin:0 0 10px 0;color:var(--green);font-size:1.1rem}
  form.grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
  @media(max-width:800px){form.grid{grid-template-columns:repeat(2,1fr)}}
  @media(max-width:460px){form.grid{grid-template-columns:1fr}}
  input,select,button,textarea{
    width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;font-family:inherit
  }
  textarea{resize:vertical}
  button.primary{background:var(--green);color:#fff;border:none}
  button.secondary{background:#eef2ff;color:#1e293b;border:1px solid #dbeafe}
  button.danger{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #f1f5f9;padding:10px;text-align:center;font-size:.95rem}
  th{background:#f9fafb;color:#111827}
  .muted{color:var(--muted);font-size:.9rem}
  .badge{display:inline-block;padding:4px 8px;border-radius:999px;background:#f1f5f9}
  .row-actions{display:flex;gap:6px;justify-content:center}
  .stats{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
  @media(max-width:800px){.stats{grid-template-columns:repeat(2,1fr)}}
  .stat{background:#fff;border-radius:14px;padding:14px;text-align:center;border:1px solid #f1f5f9}
  .stat b{display:block;font-size:1.2rem;margin-top:4px}
  /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:12px;z-index:50}
  .modal{background:#fff;max-width:520px;width:100%;border-radius:14px;padding:16px}
  .modal header{background:transparent;color:#111;padding:0;margin-bottom:6px}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div>
      <h1>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø¯ÙˆØ§Ø¬Ù†</h1>
      <small>ÙˆØ§Ø¬Ù‡Ø© Ø®ÙÙŠÙØ© ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØªØ®Ø²Ù† Ù…Ø­Ù„ÙŠÙ‹Ø§ (Ù…Ø¹ ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©)</small>
    </div>
    <div class="toolbar">
      <button id="btnExport" class="secondary">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø©</button>
      <label class="secondary" style="display:inline-flex;align-items:center;gap:6px;cursor:pointer;padding:10px">
        â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯
        <input id="importFile" type="file" accept="application/json" style="display:none">
      </label>
      <button id="btnClearAll" class="danger">ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
  </div>
</header>

<nav>
  <a href="#reports" class="active" onclick="switchTab('reports',this)">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</a>
  <a href="#inventory" onclick="switchTab('inventory',this)">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
</nav>

<main>

  <!-- Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø³Ø±ÙŠØ¹Ø© -->
  <div class="stats card">
    <div class="stat">
      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
      <b id="statReports">0</b>
      <span class="muted">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</span>
    </div>
    <div class="stat">
      Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
      <b id="statItems">0</b>
      <span class="muted">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù</span>
    </div>
    <div class="stat">
      Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ±
      <b id="statLastReport">â€”</b>
      <span class="muted">ØªØ§Ø±ÙŠØ®</span>
    </div>
    <div class="stat">
      Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„
      <b id="statLastUpdate">â€”</b>
      <span class="muted">Ù…Ø­Ù„ÙŠÙ‹Ø§</span>
    </div>
  </div>

  <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
  <section id="tab-reports" class="card">
    <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
    <form id="formReport" class="grid" onsubmit="addReport(event)">
      <input type="date" id="r_date" required />
      <input type="number" id="r_mort" placeholder="Ø§Ù„Ù†ÙÙˆÙ‚" min="0" />
      <input type="number" step="0.01" id="r_feed" placeholder="Ø§Ù„Ø¹Ù„Ù (ÙƒØº)" />
      <input type="number" step="0.01" id="r_water" placeholder="Ø§Ù„Ù…Ø§Ø¡ (Ù„ØªØ±)" />
      <input type="number" step="0.1" id="r_temp" placeholder="Ø§Ù„Ø­Ø±Ø§Ø±Ø© Â°C" />
      <input type="number" step="0.1" id="r_hum" placeholder="Ø§Ù„Ø±Ø·ÙˆØ¨Ø© %" />
      <input type="number" step="0.01" id="r_fuel" placeholder="ÙˆÙ‚ÙˆØ¯ Ø§Ù„ØªØ¯ÙØ¦Ø©" />
      <input type="number" step="0.01" id="r_wages" placeholder="Ø±ÙˆØ§ØªØ¨ Ø§Ù„ÙŠÙˆÙ…" />
      <textarea id="r_notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" rows="1" style="grid-column:1/-1"></textarea>
      <button class="primary" type="submit" style="grid-column:1/-1">â• Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±</button>
    </form>

    <div class="toolbar" style="margin-top:10px">
      <input id="searchReports" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±..." oninput="renderReports()" />
      <span class="muted">ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>
    </div>

    <table id="tblReports">
      <thead>
        <tr>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>Ù†ÙÙˆÙ‚</th>
          <th>Ø¹Ù„Ù</th>
          <th>Ù…Ø§Ø¡</th>
          <th>Â°C</th>
          <th>%RH</th>
          <th>ÙˆÙ‚ÙˆØ¯</th>
          <th>Ø±ÙˆØ§ØªØ¨</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
  <section id="tab-inventory" class="card" style="display:none">
    <h2>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
    <form id="formItem" class="grid" onsubmit="addItem(event)">
      <input id="i_name" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù (Ù…Ø«Ø§Ù„: Ø¹Ù„Ù Ø¨Ø§Ø¯Ø¦)" required />
      <select id="i_type" required>
        <option value="" disabled selected>Ù†ÙˆØ¹ Ø§Ù„ØµÙ†Ù</option>
        <option value="feed">Ø¹Ù„Ù</option>
        <option value="fuel">ÙˆÙ‚ÙˆØ¯</option>
        <option value="med">Ø¯ÙˆØ§Ø¡/Ù„Ù‚Ø§Ø­</option>
        <option value="mat">Ù…ÙˆØ§Ø¯ Ø£Ø®Ø±Ù‰</option>
      </select>
      <input id="i_qty" type="number" step="0.001" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" required />
      <input id="i_unit" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø© (ÙƒØº/Ù„ØªØ±/ÙƒØ±ØªÙˆÙ†Ø©...)" required />
      <textarea id="i_notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" rows="1" style="grid-column:1/-1"></textarea>
      <button class="primary" type="submit" style="grid-column:1/-1">â• Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù</button>
    </form>

    <div class="toolbar" style="margin-top:10px">
      <input id="searchItems" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£ØµÙ†Ø§Ù..." oninput="renderItems()" />
      <span class="muted">Ø¹Ø¯Ù‘Ù„ Ø£Ùˆ Ø§Ø­Ø°Ù Ø£ÙŠ ØµÙ†Ù Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„</span>
    </div>

    <table id="tblItems">
      <thead>
        <tr>
          <th>Ø§Ù„ØµÙ†Ù</th>
          <th>Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

</main>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø§Ù…Ø© -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <header><h3 id="modalTitle">ØªØ¹Ø¯ÙŠÙ„</h3></header>
    <div id="modalBody"></div>
    <div class="toolbar" style="justify-content:flex-end;margin-top:12px">
      <button class="secondary" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
      <button class="primary" id="modalSaveBtn">Ø­ÙØ¸</button>
    </div>
  </div>
</div>

<script>
  // ======== Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ®Ø²ÙŠÙ† ========
  const LS_KEY = "farm-app-v1";
  const state = loadState() || { reports: [], items: [], lastUpdate: null };

  function saveState(){
    state.lastUpdate = new Date().toISOString();
    localStorage.setItem(LS_KEY, JSON.stringify(state));
    updateStats();
  }
  function loadState(){
    try{ return JSON.parse(localStorage.getItem(LS_KEY)); }catch(_){ return null; }
  }

  // ======== Ø£Ø¯ÙˆØ§Øª Ø¹Ø§Ù…Ø© ========
  function fmt(n){ return (n??"") === "" ? "" : Number(n).toString(); }
  function today(){ return new Date().toISOString().slice(0,10); }
  document.getElementById('r_date').value = today();

  function switchTab(tab, el){
    document.querySelectorAll('nav a').forEach(a=>a.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('tab-reports').style.display = (tab==='reports')?'block':'none';
    document.getElementById('tab-inventory').style.display = (tab==='inventory')?'block':'none';
  }

  function updateStats(){
    document.getElementById('statReports').textContent = state.reports.length;
    document.getElementById('statItems').textContent = state.items.length;
    document.getElementById('statLastReport').textContent = state.reports.length ? state.reports[state.reports.length-1].date : 'â€”';
    document.getElementById('statLastUpdate').textContent = state.lastUpdate ? new Date(state.lastUpdate).toLocaleString() : 'â€”';
  }

  // ======== Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (CRUD) ========
  function addReport(e){
    e.preventDefault();
    const r = {
      id: crypto.randomUUID(),
      date: document.getElementById('r_date').value || today(),
      mort: Number(document.getElementById('r_mort').value||0),
      feed: Number(document.getElementById('r_feed').value||0),
      water: Number(document.getElementById('r_water').value||0),
      temp: document.getElementById('r_temp').value === "" ? null : Number(document.getElementById('r_temp').value),
      hum:  document.getElementById('r_hum').value === "" ? null : Number(document.getElementById('r_hum').value),
      fuel: Number(document.getElementById('r_fuel').value||0),
      wages:Number(document.getElementById('r_wages').value||0),
      notes: document.getElementById('r_notes').value.trim()
    };
    state.reports.push(r);
    saveState();
    renderReports();
    e.target.reset();
    document.getElementById('r_date').value = today();
  }

  function renderReports(){
    const term = (document.getElementById('searchReports').value||"").toLowerCase();
    const tbody = document.querySelector('#tblReports tbody');
    tbody.innerHTML = "";
    const list = state.reports.filter(r =>
      r.date.includes(term) || (r.notes||"").toLowerCase().includes(term)
    );
    list.forEach(r=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><span class="badge">${r.date}</span></td>
        <td>${fmt(r.mort)}</td>
        <td>${fmt(r.feed)}</td>
        <td>${fmt(r.water)}</td>
        <td>${r.temp ?? ""}</td>
        <td>${r.hum ?? ""}</td>
        <td>${fmt(r.fuel)}</td>
        <td>${fmt(r.wages)}</td>
        <td style="max-width:260px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="${r.notes||""}">${r.notes||""}</td>
        <td class="row-actions">
          <button class="secondary" onclick="openEditReport('${r.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" onclick="deleteReport('${r.id}')">Ø­Ø°Ù</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function deleteReport(id){
    if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ')) return;
    const i = state.reports.findIndex(r=>r.id===id);
    if(i>-1){ state.reports.splice(i,1); saveState(); renderReports(); }
  }

  function openEditReport(id){
    const r = state.reports.find(x=>x.id===id);
    if(!r) return;
    openModal('ØªØ¹Ø¯ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± ÙŠÙˆÙ…ÙŠ', `
      <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px">
        <input type="date" id="er_date" value="${r.date}">
        <input type="number" id="er_mort" placeholder="Ø§Ù„Ù†ÙÙˆÙ‚" value="${r.mort}">
        <input type="number" step="0.01" id="er_feed" placeholder="Ø§Ù„Ø¹Ù„Ù" value="${r.feed}">
        <input type="number" step="0.01" id="er_water" placeholder="Ø§Ù„Ù…Ø§Ø¡" value="${r.water}">
        <input type="number" step="0.1" id="er_temp" placeholder="Â°C" value="${r.temp ?? ''}">
        <input type="number" step="0.1" id="er_hum" placeholder="%RH" value="${r.hum ?? ''}">
        <input type="number" step="0.01" id="er_fuel" placeholder="ÙˆÙ‚ÙˆØ¯" value="${r.fuel}">
        <input type="number" step="0.01" id="er_wages" placeholder="Ø±ÙˆØ§ØªØ¨" value="${r.wages}">
        <textarea id="er_notes" rows="2" style="grid-column:1/-1" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">${r.notes||''}</textarea>
      </div>
    `, ()=>{
      r.date = document.getElementById('er_date').value || r.date;
      r.mort = Number(document.getElementById('er_mort').value||0);
      r.feed = Number(document.getElementById('er_feed').value||0);
      r.water = Number(document.getElementById('er_water').value||0);
      r.temp = document.getElementById('er_temp').value===""?null:Number(document.getElementById('er_temp').value);
      r.hum  = document.getElementById('er_hum').value===""?null:Number(document.getElementById('er_hum').value);
      r.fuel = Number(document.getElementById('er_fuel').value||0);
      r.wages= Number(document.getElementById('er_wages').value||0);
      r.notes= document.getElementById('er_notes').value.trim();
      saveState(); renderReports(); closeModal();
    });
  }

  // ======== Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (CRUD) ========
  function addItem(e){
    e.preventDefault();
    const it = {
      id: crypto.randomUUID(),
      name: document.getElementById('i_name').value.trim(),
      type: document.getElementById('i_type').value,
      qty: Number(document.getElementById('i_qty').value||0),
      unit: document.getElementById('i_unit').value.trim(),
      notes: document.getElementById('i_notes').value.trim()
    };
    state.items.push(it);
    saveState();
    renderItems();
    e.target.reset();
  }

  function renderItems(){
    const term = (document.getElementById('searchItems').value||"").toLowerCase();
    const tbody = document.querySelector('#tblItems tbody');
    tbody.innerHTML = "";
    const list = state.items.filter(i =>
      i.name.toLowerCase().includes(term) || (i.notes||"").toLowerCase().includes(term)
    );
    list.forEach(i=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i.name}</td>
        <td><span class="badge">${typeLabel(i.type)}</span></td>
        <td>${fmt(i.qty)}</td>
        <td>${i.unit}</td>
        <td style="max-width:240px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="${i.notes||""}">${i.notes||""}</td>
        <td class="row-actions">
          <button class="secondary" onclick="openEditItem('${i.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" onclick="deleteItem('${i.id}')">Ø­Ø°Ù</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function typeLabel(t){
    return {feed:'Ø¹Ù„Ù', fuel:'ÙˆÙ‚ÙˆØ¯', med:'Ø¯ÙˆØ§Ø¡/Ù„Ù‚Ø§Ø­', mat:'Ù…ÙˆØ§Ø¯ Ø£Ø®Ø±Ù‰'}[t] || t;
  }

  function deleteItem(id){
    if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ')) return;
    const i = state.items.findIndex(x=>x.id===id);
    if(i>-1){ state.items.splice(i,1); saveState(); renderItems(); }
  }

  function openEditItem(id){
    const i = state.items.find(x=>x.id===id);
    if(!i) return;
    openModal('ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù Ù…Ø®Ø²ÙˆÙ†', `
      <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:10px">
        <input id="ei_name" value="${i.name}">
        <select id="ei_type">
          <option value="feed" ${i.type==='feed'?'selected':''}>Ø¹Ù„Ù</option>
          <option value="fuel" ${i.type==='fuel'?'selected':''}>ÙˆÙ‚ÙˆØ¯</option>
          <option value="med" ${i.type==='med'?'selected':''}>Ø¯ÙˆØ§Ø¡/Ù„Ù‚Ø§Ø­</option>
          <option value="mat" ${i.type==='mat'?'selected':''}>Ù…ÙˆØ§Ø¯ Ø£Ø®Ø±Ù‰</option>
        </select>
        <input id="ei_qty" type="number" step="0.001" value="${i.qty}">
        <input id="ei_unit" value="${i.unit}">
        <textarea id="ei_notes" rows="2" style="grid-column:1/-1">${i.notes||''}</textarea>
      </div>
    `, ()=>{
      i.name = document.getElementById('ei_name').value.trim() || i.name;
      i.type = document.getElementById('ei_type').value;
      i.qty  = Number(document.getElementById('ei_qty').value||0);
      i.unit = document.getElementById('ei_unit').value.trim();
      i.notes= document.getElementById('ei_notes').value.trim();
      saveState(); renderItems(); closeModal();
    });
  }

  // ======== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ========
  const backdrop = document.getElementById('modalBackdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody  = document.getElementById('modalBody');
  const modalSave  = document.getElementById('modalSaveBtn');

  function openModal(title, bodyHTML, onSave){
    modalTitle.textContent = title;
    modalBody.innerHTML = bodyHTML;
    modalSave.onclick = onSave;
    backdrop.style.display = 'flex';
  }
  function closeModal(){ backdrop.style.display = 'none'; }

  // ======== ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯/Ù…Ø³Ø­ ========
  document.getElementById('btnExport').onclick = ()=>{
    const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `farm-backup-${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.json`;
    a.click();
  };

  document.getElementById('importFile').onchange = (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(reader.result);
        if(!data || !Array.isArray(data.reports) || !Array.isArray(data.items)){
          alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); return;
        }
        state.reports = data.reports;
        state.items   = data.items;
        state.lastUpdate = new Date().toISOString();
        saveState();
        renderReports(); renderItems();
        alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
      }catch(_){ alert('ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'); }
    };
    reader.readAsText(file);
    e.target.value = "";
  };

  document.getElementById('btnClearAll').onclick = ()=>{
    if(confirm('Ø³ÙŠØªÙ… Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')){
      localStorage.removeItem(LS_KEY);
      state.reports=[]; state.items=[]; state.lastUpdate=null;
      renderReports(); renderItems(); updateStats();
    }
  };

  // ======== Ø¥Ù‚Ù„Ø§Ø¹ Ø§Ù„ØµÙØ­Ø© ========
  renderReports();
  renderItems();
  updateStats();
</script>

</body>
</html>
